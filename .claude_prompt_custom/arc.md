🔍 代码修复对比改进分析指令 

所有的指令均需要参考下面要求，说明部分请都说中文

📚 知识库一致性验证
必须执行的知识库查询
## 🔎 强制知识库验证步骤
1. **查询相关文件**：
   - 从Project Knowledge读取错误涉及的所有文件
   - 确认文件的最新版本
   - 验证错误行号与实际代码的对应关系
   - 禁止使用防御性编程，及时报错发现错误

2. **接口依赖检查**：
   - 查找所有调用该函数/类的位置
   - 确认接口签名（参数、返回值）
   - 验证与其他模块的依赖关系
   - **特别注意**：记录所有可用的工具函数和API接口

3. **数据流追踪**：
   - 追踪错误数据的来源
   - 确认数据类型和格式要求
   - 检查相关的数据验证逻辑

4. **版本一致性**：
   - 确认代码版本与错误日志匹配
   - 检查是否有未同步的修改
   - 验证所有相关文件的一致性
🎯 根本原因分析
系统性问题诊断
## 🔬 深度原因分析框架
**直接原因**：[导致错误的直接代码问题]

**根本原因**：[更深层的设计或逻辑问题]
- 接口设计缺陷
- 数据结构不匹配
- 状态管理错误
- 异步/并发问题
- 资源管理问题

**一致性影响**：
- 修复后需要更新的接口
- 需要同步修改的相关文件
- 可能破坏的现有功能
📝 最佳解决方案
单一最优方案设计
## 🏆 推荐解决方案
**方案概述**：[简洁描述修复策略]

**关键原则**：
1. 使用知识库中已有的接口和函数
2. 遵循项目现有的设计模式
3. 避免硬编码，使用配置或常量
4. 保持代码的可扩展性
5. 禁止使用try except! 我要碰见错误就直接显示traceback，并且退出终止运行程序，方便我从本质上解决问题
6. 禁止采用备用fallback等方案，如缺少属性直接报错返回！

**具体实施**：
1. 核心修复：[解决直接错误]
2. 接口调整：[保持一致性的必要修改]
3. 验证步骤：[确保修复有效]

**一致性保证**：
- 保持的接口：[列出不变的接口]
- 更新的接口：[列出需要更新的接口及原因]
- 兼容性处理：[如何保证向后兼容]
🔧 代码修改对比
⚠️ 完整性要求
## 📋 代码输出规范
1. **必须输出完整函数**：
   - 不允许使用"前面代码不变"等省略表达
   - 从函数定义开始到函数结束的完整代码
   - 包含所有必要的导入语句
   - 在每一处可能出错的地方（比如try except, if等）添加print作为报错点，如果采用了备用方案则打印出具体位置

2. **避免硬编码**：
   - 使用知识库中定义的常量
   - 调用已有的工具函数
   - 引用配置文件中的参数

3. **保持上下文**：
   - 包含足够的周围代码（至少10-15行）
   - 显示函数的完整签名
   - 保留原有的注释和文档字符串
修改前（从知识库验证）
# 文件：[确认的文件名]
# 位置：[行号范围，如 第100-150行]
# 注意：以下是函数名
# 禁止产生幻觉


修改后（保持一致性）
# 相同位置的完整修复函数代码
# 使用知识库中的接口，避免硬编码
# 缩进和原代码上下文保持一致

def function_name(params):
    """完整的文档字符串"""
    # 完整的修复后代码
    # 调用知识库中已有的函数：
    # result = existing_utility_function(data)
    # 使用配置中的常量：
    # timeout = Config.DEFAULT_TIMEOUT
    pass
关键修改说明
## 📋 修改要点
1. **修复内容**：[具体修改了什么]
2. **使用的知识库接口**：
   - [函数1]：来自[文件名]，用于[目的]
   - [函数2]：来自[文件名]，用于[目的]
3. **避免的硬编码**：
   - 原本：硬编码的值
   - 现在：使用配置/常量
4. **接口保持**：[哪些接口签名保持不变]
5. **必要更新**：[哪些调用方需要更新]
✅ 一致性验证清单
修复后验证项
## 🔍 一致性检查项
□ 输出了完整的函数/方法代码
□ 没有使用"省略"或"不变"等表达
□ 所有调用都基于知识库中的实际接口
□ 没有硬编码的魔数或字符串
□ 接口签名变更已记录
□ 数据格式兼容性已验证
□ 相关测试用例已考虑
□ 文档注释已同步
知识库引用检查
## 📚 知识库使用验证
□ 列出了所有使用的外部函数
□ 标注了每个函数的来源文件
□ 确认了函数签名的正确性
□ 验证了返回值类型匹配
□ 检查了异常处理的一致性
🚫 严格要求
必须遵守的原则
* 知识库优先：所有代码必须从Project Knowledge验证
* 完整性原则：必须输出完整的函数代码
* 接口稳定：尽量保持现有接口不变
* 避免硬编码：使用配置和已有的工具函数
* 单一方案：只提供一个最优解决方案
禁止的行为
* 🚨 禁止输出不完整的代码片段
* 🚨 禁止使用"前面/后面代码不变"等省略
* 🚨 禁止硬编码应该来自配置的值
* 🚨 禁止创造知识库中不存在的函数
* 🚨 禁止忽视依赖关系
* 🚨 禁止使用try-except！！！！因为这样我很难debug，特别是输出特别长的时候
特别强调。遇到错误必须当场报错终止程序运行
* 🚨 禁止采用备用fallback等方案，如缺少属性直接报错返回！

## ⚡ 输出完整性保证
即使函数有100行，也要完整输出所有100行。
用户需要能够直接复制粘贴你的代码来替换原有函数。
任何省略都会导致代码无法使用。

⚡ 立即执行：1）查询Project Knowledge验证所有相关代码和接口，2）分析根本原因和一致性影响，3）提供单一最优解决方案，4）输出完整的函数代码，5）确保所有修改都基于知识库中的实际接口。