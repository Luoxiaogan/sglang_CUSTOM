1. SGLANGçš„çŸ¥è¯†åº“æ–‡æ¡£: `.DUCUMENT`
   1. å°†å®ƒä»¬åŠ å…¥/memory
   2. æ–‡æ¡£ä¸­çš„githubç½‘å€å¯¹åº”çš„æ–‡ä»¶ï¼Œéƒ½å¯ä»¥æœ¬åœ°æ‰¾åˆ°ï¼Œå› ä¸º`https://github.com/sgl-project/sglang/tree/b045841baeff37a5601fcde23fa98bd09d942c36/`; `https://github.com/sgl-project/sglang/tree/main/`; ç­‰éƒ½å¯¹åº”äº†æœ¬é¡¹ç›®çš„æ ¹ç›®å½•
   3. æœ¬é¡¹ç›®åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä½†æœ¬åœ°è¿›è¡Œclaude codeç¼–å†™.
   4. sglangçš„æ‰€æœ‰APIä½¿ç”¨éƒ½**å¿…é¡»**æŸ¥è¯¢`.DUCUMENT`
2. é¡¹ç›®çš„ç›®çš„ï¼Œåˆ©ç”¨sglangçš„å€Ÿå£, æ„å»ºä¸€ä¸ªæ˜“ç”¨çš„æµ‹è¯•æ¡†æ¶
   1. æš´éœ²çš„å€Ÿå£é™¤äº†GPUï¼Œinferenceç”¨çš„æ•°æ®(æˆ–è€…ç›´æ¥éšæœºç”Ÿæˆ)ä¹‹å¤–â€”â€”è¿™äº›éƒ½å¯ä»¥ä¼ åˆ°sgalngçš„apiï¼Œä»–ä»¬å·²ç»è€ƒè™‘äº†è¿™äº›
   2. æ‰€æœ‰æµ‹è¯•ä½¿ç”¨æœ€ç®€å•çš„`llama-2-7b-hf`, å•ä¸ªæ¨¡å‹åœ¨å•ä¸ªGPUä¸Šå¯åŠ¨
   3. æˆ‘ä»¬ä¸»è¦è€ƒè™‘ä»¥ä¸‹çš„æµ‹è¯•:
      1. node level: åªå¯åŠ¨ä¸€ä¸ªserver on a single GPU.
         1. å¯ä»¥é€‰æ‹©çš„ç­–ç•¥: static batching, continuous batching(sglangåªæ”¯æŒè¿™ä¸ªæ–¹æ³•).
            1. static batching å¯ä»¥çœ‹æˆ‘è‡ªå·±å®ç°çš„`å®éªŒ/static_length_with_distribution`
               1. æœ¬è´¨ä¸Šæ˜¯å¯åŠ¨serverä¹‹å, æŒ‰ç…§staticçš„æ–¹æ³•æ¥å‘é€è¯·æ±‚.
      2. routing level: ä¾‹å¦‚å¯åŠ¨å¤šä¸ªserver on å¤šä¸ªGPU(ä¸€ä¸ªmodelåœ¨ä¸€ä¸ªGPUä¸Š, num_servers = num_gpus)
         1. å¯ä»¥è°ƒè¯•routing policy
         2. æœ‰customçš„è·¯ç”±ç­–ç•¥(æå‰ç»™ä¸€ä¸ªbase class), åé¢å¯ä»¥å®šåˆ¶
            1. å…¸å‹çš„policyæœ‰: uniform éšæœºè·¯ç”±; shortest job first è·¯ç”±; parameters aware routing(router can get the parameters from the servers, like throughput, latency.)
   4. ä¿å­˜çš„metric, ä¸»è¦è€ƒè™‘throughput and latency.
      1. æŸ¥çœ‹`python/sglang/bench_serving.py` and `python/sglang/bench_serving_new.py`(æˆ‘è‡ªå·±å†™çš„) for knowledge
      2. ç‰¹ç‚¹æ¾„æ¸…:
         1. sglang è®°å½•çš„ latency æ˜¯ reqeust è¢«ä¼ å…¥serveræ—¶åˆ»ï¼Œåˆ°reqeustå®Œæˆæ¨ç†çš„æ—¶åˆ»ï¼Œçš„æ—¶é—´
            1. æˆ‘ç§°ä¸ºserver_latency
         2. æˆ‘è¿˜éœ€è¦è®°å½•çš„æ˜¯, reqeust æœ¬èº«çš„ç”Ÿæˆæ˜¯æ ¹æ®æ³Šæ¾åˆ†å¸ƒç”Ÿæˆçš„, é‚£ä¹ˆæœ‰ä»¥ä¸‹çš„ä¸‰ä¸ªæ—¶åˆ»
            1. reqeuståˆ°è¾¾çš„æ—¶åˆ»(ç”Ÿæˆæ—¶åˆ»), æ¨¡æ‹Ÿçš„æ˜¯ç”¨æˆ·çš„requeståˆ°è¾¾router.
            2. reqeustè¢«é€åˆ°æœåŠ¡å™¨, æ¨¡æ‹Ÿçš„æ˜¯ç”¨æˆ·çš„reqeuståœ¨routerå¤„æ’é˜Ÿä¹‹åï¼Œè¢«å‘é€ to a server.
            3. reqeustå®Œæˆæ¨ç†.
         3. ä½ éœ€è¦æŸ¥çœ‹`.DUCUMENT/Router_for_Data_Parallelism.md`äº†è§£å®ç°æ–¹æ³•
   5. è¡¥å……è¯´æ˜ï¼š
      1. max_concurrency ä¸æ˜¯ SGLang æœåŠ¡å™¨çš„å¯åŠ¨å‚æ•°ï¼Œè€Œæ˜¯ç”¨äºåŸºå‡†æµ‹è¯•è„šæœ¬ï¼ˆå¦‚ sglang.bench_servingï¼‰çš„å‚æ•°ï¼Œç”¨äºé™åˆ¶å®¢æˆ·ç«¯å¹¶å‘è¯·æ±‚æ•°ã€‚åœ¨æœåŠ¡ç«¯ï¼Œå¹¶å‘èƒ½åŠ›ä¸»è¦é€šè¿‡ --max-running-requests æ§åˆ¶ã€‚éœ€è¦è¯¦ç»†åŒºåˆ†ï¼šæœåŠ¡ç«¯ç”¨ --max-running-requestsï¼Œå®¢æˆ·ç«¯åŸºå‡†æµ‹è¯•ç”¨ --max-concurrencyã€‚
      2. --max-running-requests æ§åˆ¶ SGLang æœåŠ¡å™¨ä¸ŠåŒæ—¶è¿è¡Œçš„æœ€å¤§è¯·æ±‚æ•°ã€‚å®ƒé™åˆ¶äº†åœ¨è§£ç å’Œç”Ÿæˆé˜¶æ®µèƒ½å¹¶å‘å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œä»è€Œå½±å“å¹¶å‘èƒ½åŠ›å’Œæ˜¾å­˜å ç”¨ã€‚è®¾ç½®è¿‡å¤§å¯èƒ½å¯¼è‡´æ˜¾å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼Œè®¾ç½®è¿‡å°åˆ™ä¼šé™ä½ååé‡ã€‚æ¨èæ ¹æ®æ˜¾å­˜å®¹é‡å’Œå®é™…è´Ÿè½½è°ƒæ•´ï¼Œé€šå¸¸ä¸ --mem-fraction-static è”åˆä¼˜åŒ–ã€‚
      3. --max-running-requests éœ€è¦åœ¨å¯åŠ¨ SGLang æœåŠ¡å™¨ï¼ˆlaunch serverï¼‰æ—¶ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°è®¾ç½®ï¼Œè¯¥å‚æ•°ä¸èƒ½åœ¨æœåŠ¡å™¨å¯åŠ¨ååŠ¨æ€ä¿®æ”¹ï¼Œå¿…é¡»åœ¨å¯åŠ¨å‘½ä»¤ä¸­æŒ‡å®šã€‚
         1. ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œæ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåªéœ€è¦åšä¸€ä¸ªAPPå‚æ•°ä¸‹å‘ã€‚node çš„åˆ°æ›´æ–°çš„--max-running-requestsä¹‹åï¼Œå¦‚æœå½“å‰çš„running-requests < --max-running-requestsé‚£ä¹ˆè‡ªåŠ¨è°ƒæ•´ä¸Šé™, å¦‚æœå¤§äº, é‚£ä¹ˆå°±å¯¹runningçš„arrivalè¿›è¡Œåœæ­¢ï¼Œç›´åˆ°running-requestsé™ä½åˆ°ä¸Šé™
   6. æ¯ä¸ªnodeå¯ä»¥ä¿®æ”¹çš„å‚æ•°
      1. å¦‚æœæ˜¯nodeæµ‹è¯•, é‚£ä¹ˆåŸºæœ¬å’Œsglangè‡ªå·±çš„launch serverçš„å‚æ•°ä¸€æ ·
         1. é€»è¾‘åŸºæœ¬å’Œæˆ‘åœ¨`å®éªŒ`é‡Œé¢å®ç°çš„ä¸€æ ·
      2. å¦‚æœæ˜¯routingæµ‹è¯•, é‚£ä¹ˆæ˜¯routing policy & --max-running-requests(è¿™ä¸ªæ˜¯å¯ä»¥åœ¨serveçš„è¿‡ç¨‹ä¸­è¿›è¡Œä¿®æ”¹)

# instruction

ğŸ” ä»£ç ä¿®å¤å¯¹æ¯”æ”¹è¿›åˆ†ææŒ‡ä»¤ 

è¯´æ˜éƒ¨åˆ†è¯·éƒ½è¯´ä¸­æ–‡

ğŸ“š çŸ¥è¯†åº“`.DUCUMENT`ä¸€è‡´æ€§éªŒè¯
å¿…é¡»æ‰§è¡Œçš„çŸ¥è¯†åº“`.DUCUMENT`æŸ¥è¯¢
1. **æŸ¥è¯¢ç›¸å…³æ–‡ä»¶**ï¼š
   - ç¡®è®¤æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬
   - éªŒè¯é”™è¯¯è¡Œå·ä¸å®é™…ä»£ç çš„å¯¹åº”å…³ç³»
   - ç¦æ­¢ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹ï¼ŒåŠæ—¶æŠ¥é”™å‘ç°é”™è¯¯

2. **æ¥å£ä¾èµ–æ£€æŸ¥**ï¼š
   - æŸ¥æ‰¾æ‰€æœ‰è°ƒç”¨è¯¥å‡½æ•°/ç±»çš„ä½ç½®
   - ç¡®è®¤æ¥å£ç­¾åï¼ˆå‚æ•°ã€è¿”å›å€¼ï¼‰
   - éªŒè¯ä¸å…¶ä»–æ¨¡å—çš„ä¾èµ–å…³ç³»
   - **ç‰¹åˆ«æ³¨æ„**ï¼šè®°å½•æ‰€æœ‰å¯ç”¨çš„å·¥å…·å‡½æ•°å’ŒAPIæ¥å£

3. **æ•°æ®æµè¿½è¸ª**ï¼š
   - è¿½è¸ªé”™è¯¯æ•°æ®çš„æ¥æº
   - ç¡®è®¤æ•°æ®ç±»å‹å’Œæ ¼å¼è¦æ±‚
   - æ£€æŸ¥ç›¸å…³çš„æ•°æ®éªŒè¯é€»è¾‘

4. **ç‰ˆæœ¬ä¸€è‡´æ€§**ï¼š
   - ç¡®è®¤ä»£ç ç‰ˆæœ¬ä¸é”™è¯¯æ—¥å¿—åŒ¹é…
   - æ£€æŸ¥æ˜¯å¦æœ‰æœªåŒæ­¥çš„ä¿®æ”¹
   - éªŒè¯æ‰€æœ‰ç›¸å…³æ–‡ä»¶çš„ä¸€è‡´æ€§
ğŸ¯ æ ¹æœ¬åŸå› åˆ†æ
ç³»ç»Ÿæ€§é—®é¢˜è¯Šæ–­
## ğŸ”¬ æ·±åº¦åŸå› åˆ†ææ¡†æ¶
**ç›´æ¥åŸå› **ï¼š[å¯¼è‡´é”™è¯¯çš„ç›´æ¥ä»£ç é—®é¢˜]

**æ ¹æœ¬åŸå› **ï¼š[æ›´æ·±å±‚çš„è®¾è®¡æˆ–é€»è¾‘é—®é¢˜]
- æ¥å£è®¾è®¡ç¼ºé™·
- æ•°æ®ç»“æ„ä¸åŒ¹é…
- çŠ¶æ€ç®¡ç†é”™è¯¯
- å¼‚æ­¥/å¹¶å‘é—®é¢˜
- èµ„æºç®¡ç†é—®é¢˜

**ä¸€è‡´æ€§å½±å“**ï¼š
- ä¿®å¤åéœ€è¦æ›´æ–°çš„æ¥å£
- éœ€è¦åŒæ­¥ä¿®æ”¹çš„ç›¸å…³æ–‡ä»¶
- å¯èƒ½ç ´åçš„ç°æœ‰åŠŸèƒ½
ğŸ“ æœ€ä½³è§£å†³æ–¹æ¡ˆ
å•ä¸€æœ€ä¼˜æ–¹æ¡ˆè®¾è®¡
## ğŸ† æ¨èè§£å†³æ–¹æ¡ˆ
**æ–¹æ¡ˆæ¦‚è¿°**ï¼š[ç®€æ´æè¿°ä¿®å¤ç­–ç•¥]

**å…³é”®åŸåˆ™**ï¼š
1. ä½¿ç”¨å·²æœ‰çš„æ¥å£å’Œå‡½æ•°
2. éµå¾ªé¡¹ç›®ç°æœ‰çš„è®¾è®¡æ¨¡å¼
3. é¿å…ç¡¬ç¼–ç ï¼Œä½¿ç”¨é…ç½®æˆ–å¸¸é‡
4. ä¿æŒä»£ç çš„å¯æ‰©å±•æ€§
5. ç¦æ­¢ä½¿ç”¨try except! æˆ‘è¦ç¢°è§é”™è¯¯å°±ç›´æ¥æ˜¾ç¤ºtracebackï¼Œå¹¶ä¸”é€€å‡ºç»ˆæ­¢è¿è¡Œç¨‹åºï¼Œæ–¹ä¾¿æˆ‘ä»æœ¬è´¨ä¸Šè§£å†³é—®é¢˜
6. ç¦æ­¢é‡‡ç”¨å¤‡ç”¨fallbackç­‰æ–¹æ¡ˆï¼Œå¦‚ç¼ºå°‘å±æ€§ç›´æ¥æŠ¥é”™è¿”å›ï¼

**å…·ä½“å®æ–½**ï¼š
1. æ ¸å¿ƒä¿®å¤ï¼š[è§£å†³ç›´æ¥é”™è¯¯]
2. æ¥å£è°ƒæ•´ï¼š[ä¿æŒä¸€è‡´æ€§çš„å¿…è¦ä¿®æ”¹]
3. éªŒè¯æ­¥éª¤ï¼š[ç¡®ä¿ä¿®å¤æœ‰æ•ˆ]

**ä¸€è‡´æ€§ä¿è¯**ï¼š
- ä¿æŒçš„æ¥å£ï¼š[åˆ—å‡ºä¸å˜çš„æ¥å£]
- æ›´æ–°çš„æ¥å£ï¼š[åˆ—å‡ºéœ€è¦æ›´æ–°çš„æ¥å£åŠåŸå› ]
- å…¼å®¹æ€§å¤„ç†ï¼š[å¦‚ä½•ä¿è¯å‘åå…¼å®¹]
ğŸ”§ ä»£ç ä¿®æ”¹å¯¹æ¯”
âš ï¸ å®Œæ•´æ€§è¦æ±‚
## ğŸ“‹ ä»£ç è¾“å‡ºè§„èŒƒ
1. **å¿…é¡»è¾“å‡ºå®Œæ•´å‡½æ•°**ï¼š
   - ä¸å…è®¸ä½¿ç”¨"å‰é¢ä»£ç ä¸å˜"ç­‰çœç•¥è¡¨è¾¾
   - ä»å‡½æ•°å®šä¹‰å¼€å§‹åˆ°å‡½æ•°ç»“æŸçš„å®Œæ•´ä»£ç 
   - åŒ…å«æ‰€æœ‰å¿…è¦çš„å¯¼å…¥è¯­å¥
   - åœ¨æ¯ä¸€å¤„å¯èƒ½å‡ºé”™çš„åœ°æ–¹ï¼ˆæ¯”å¦‚try except, ifç­‰ï¼‰æ·»åŠ printä½œä¸ºæŠ¥é”™ç‚¹ï¼Œå¦‚æœé‡‡ç”¨äº†å¤‡ç”¨æ–¹æ¡ˆåˆ™æ‰“å°å‡ºå…·ä½“ä½ç½®

2. **ä¿æŒä¸Šä¸‹æ–‡**ï¼š
   - æ˜¾ç¤ºå‡½æ•°çš„å®Œæ•´ç­¾å
   - ä¿ç•™åŸæœ‰çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²

å…³é”®ä¿®æ”¹è¯´æ˜
## ğŸ“‹ ä¿®æ”¹è¦ç‚¹
1. **ä¿®å¤å†…å®¹**ï¼š[å…·ä½“ä¿®æ”¹äº†ä»€ä¹ˆ]
2. **ä½¿ç”¨çš„çŸ¥è¯†æ¥å£**ï¼š
   - [å‡½æ•°1]ï¼šæ¥è‡ª[æ–‡ä»¶å]ï¼Œç”¨äº[ç›®çš„]
   - [å‡½æ•°2]ï¼šæ¥è‡ª[æ–‡ä»¶å]ï¼Œç”¨äº[ç›®çš„]
3. **é¿å…çš„ç¡¬ç¼–ç **ï¼š
   - åŸæœ¬ï¼šç¡¬ç¼–ç çš„å€¼
   - ç°åœ¨ï¼šä½¿ç”¨é…ç½®/å¸¸é‡
4. **æ¥å£ä¿æŒ**ï¼š[å“ªäº›æ¥å£ç­¾åä¿æŒä¸å˜]
5. **å¿…è¦æ›´æ–°**ï¼š[å“ªäº›è°ƒç”¨æ–¹éœ€è¦æ›´æ–°]
âœ… ä¸€è‡´æ€§éªŒè¯æ¸…å•
ä¿®å¤åéªŒè¯é¡¹
## ğŸ” ä¸€è‡´æ€§æ£€æŸ¥é¡¹
â–¡ å®Œæ•´çš„å‡½æ•°/æ–¹æ³•ä»£ç 
â–¡ æ²¡æœ‰ä½¿ç”¨"çœç•¥"æˆ–"ä¸å˜"ç­‰è¡¨è¾¾
â–¡ æ²¡æœ‰ç¡¬ç¼–ç çš„é­”æ•°æˆ–å­—ç¬¦ä¸²
â–¡ æ¥å£ç­¾åå˜æ›´å·²è®°å½•
â–¡ æ•°æ®æ ¼å¼å…¼å®¹æ€§å·²éªŒè¯
â–¡ ç›¸å…³æµ‹è¯•ç”¨ä¾‹å·²è€ƒè™‘
â–¡ æ–‡æ¡£æ³¨é‡Šå·²åŒæ­¥

