# GPU 2 (ç»ˆç«¯ 1)
python -m sglang.launch_server \
--model-path "/nas/models/Meta-Llama-3-8B-Instruct" \
--host "0.0.0.0" \
--port 40005 \
--base-gpu-id 2

# GPU 3 (ç»ˆç«¯ 2)
python -m sglang.launch_server \
--model-path "/nas/models/Meta-Llama-3-8B-Instruct" \
--host "0.0.0.0" \
--port 40006 \
--base-gpu-id 3

ä¹‹å:
python /nas/ganluo/sglang/start_test_router.py
ç«¯å£-GPUæ˜ å°„å·²ä¿å­˜åˆ°: /tmp/sglang_port_gpu_mapping.json
æ˜ å°„å…³ç³»:
  ç«¯å£ 40005 -> cuda:2
  ç«¯å£ 40006 -> cuda:3

å¯åŠ¨è·¯ç”±å™¨ï¼ˆå¯ç”¨è¯·æ±‚è¿½è¸ªï¼‰...
2025-07-28 14:26:30  INFO sglang_router_rs::server: src/server.rs:331: ğŸš§ Initializing Prometheus metrics on 127.0.0.1:29000
2025-07-28 14:26:30  INFO sglang_router_rs::server: src/server.rs:340: ğŸš§ Initializing router on 127.0.0.1:40009
2025-07-28 14:26:30  INFO sglang_router_rs::server: src/server.rs:341: ğŸš§ Router mode: Regular { worker_urls: ["http://localhost:40005", "http://localhost:40006"] }
2025-07-28 14:26:30  INFO sglang_router_rs::server: src/server.rs:342: ğŸš§ Policy: CacheAware { cache_threshold: 0.5, balance_abs_threshold: 32, balance_rel_threshold: 1.0001, eviction_interval_secs: 60, max_tree_size: 16777216 }
2025-07-28 14:26:30  INFO sglang_router_rs::server: src/server.rs:343: ğŸš§ Max payload size: 256 MB
2025-07-28 14:26:30  INFO sglang_router_rs::server: src/server.rs:353: ğŸš§ Service discovery disabled
2025-07-28 14:26:30  INFO sglang_router_rs::routers::router: src/routers/router.rs:181: All workers are healthy
2025-07-28 14:26:30  INFO sglang_router_rs::request_tracker: src/request_tracker.rs:65: Initializing request tracker with max_entries=100000, ttl=3600s
2025-07-28 14:26:30  INFO sglang_router_rs::server: src/server.rs:390: âœ… Serving router on 127.0.0.1:40009
2025-07-28 14:26:30  INFO sglang_router_rs::server: src/server.rs:391: âœ… Serving workers on ["http://localhost:40005", "http://localhost:40006"]
2025-07-28 14:27:30  INFO sglang_router_rs::tree: src/tree.rs:430: Before eviction - Used size per tenant:
2025-07-28 14:27:30  INFO sglang_router_rs::tree: src/tree.rs:432: Tenant: http://localhost:40006, Size: 60
2025-07-28 14:27:30  INFO sglang_router_rs::tree: src/tree.rs:432: Tenant: http://localhost:40005, Size: 44
2025-07-28 14:27:30  INFO sglang_router_rs::tree: src/tree.rs:481: After eviction - Used size per tenant:
2025-07-28 14:27:30  INFO sglang_router_rs::tree: src/tree.rs:483: Tenant: http://localhost:40006, Size: 60
2025-07-28 14:27:30  INFO sglang_router_rs::tree: src/tree.rs:483: Tenant: http://localhost:40005, Size: 44
2025-07-28 14:28:30  INFO sglang_router_rs::tree: src/tree.rs:430: Before eviction - Used size per tenant:
2025-07-28 14:28:30  INFO sglang_router_rs::tree: src/tree.rs:432: Tenant: http://localhost:40006, Size: 60
2025-07-28 14:28:30  INFO sglang_router_rs::tree: src/tree.rs:432: Tenant: http://localhost:40005, Size: 44
2025-07-28 14:28:30  INFO sglang_router_rs::tree: src/tree.rs:481: After eviction - Used size per tenant:
2025-07-28 14:28:30  INFO sglang_router_rs::tree: src/tree.rs:483: Tenant: http://localhost:40006, Size: 60
2025-07-28 14:28:30  INFO sglang_router_rs::tree: src/tree.rs:483: Tenant: http://localhost:40005, Size: 44



å†ä¹‹å:
(lg) root:/nas/ganluo# python /nas/ganluo/sglang/test_request_tracking_fixed.py
=== SGLang Router è¯·æ±‚è¿½è¸ªæµ‹è¯• ===

âœ… è·¯ç”±å™¨å¥åº·æ£€æŸ¥é€šè¿‡

å‘é€æµ‹è¯•è¯·æ±‚...
âŒ è¯·æ±‚ 1 å‡ºé”™: 200, message='Attempt to decode JSON with unexpected mimetype: ', url='http://localhost:40009/generate'
âŒ è¯·æ±‚ 2 å‡ºé”™: 200, message='Attempt to decode JSON with unexpected mimetype: ', url='http://localhost:40009/generate'
âŒ è¯·æ±‚ 3 å‡ºé”™: 200, message='Attempt to decode JSON with unexpected mimetype: ', url='http://localhost:40009/generate'
âŒ è¯·æ±‚ 4 å‡ºé”™: 200, message='Attempt to decode JSON with unexpected mimetype: ', url='http://localhost:40009/generate'
âŒ è¯·æ±‚ 5 å‡ºé”™: 200, message='Attempt to decode JSON with unexpected mimetype: ', url='http://localhost:40009/generate'

ç­‰å¾…è¯·æ±‚å¤„ç†...

æŸ¥è¯¢è¯·æ±‚è¿½è¸ªä¿¡æ¯...

æ‰¾åˆ° 5 ä¸ªæœ€è¿‘çš„è¯·æ±‚

è¯·æ±‚ 1:
  è¯·æ±‚ID: req_dbe23d5d-b225-47e7-81cf-92b189be9a22
  èŠ‚ç‚¹: gpu_1 (http://localhost:40006)
  è·¯ç”±ç­–ç•¥: cache_aware
  çŠ¶æ€: completed
  è¾“å…¥tokens: 7
  å®Œæˆæ—¶é—´: 2025-07-28T14:27:24.564889659Z

è¯·æ±‚ 2:
  è¯·æ±‚ID: req_5c6df5e5-b1ad-47e9-9a12-693ca23c491b
  èŠ‚ç‚¹: gpu_0 (http://localhost:40005)
  è·¯ç”±ç­–ç•¥: cache_aware
  çŠ¶æ€: completed
  è¾“å…¥tokens: 7
  å®Œæˆæ—¶é—´: 2025-07-28T14:27:24.392079771Z

è¯·æ±‚ 3:
  è¯·æ±‚ID: req_a279b425-6496-49e4-9b39-75952f63755d
  èŠ‚ç‚¹: gpu_1 (http://localhost:40006)
  è·¯ç”±ç­–ç•¥: cache_aware
  çŠ¶æ€: completed
  è¾“å…¥tokens: 7
  å®Œæˆæ—¶é—´: 2025-07-28T14:27:24.217739911Z

è¯·æ±‚ 4:
  è¯·æ±‚ID: req_e0934740-200f-4fcb-9167-791cae13b9bc
  èŠ‚ç‚¹: gpu_0 (http://localhost:40005)
  è·¯ç”±ç­–ç•¥: cache_aware
  çŠ¶æ€: completed
  è¾“å…¥tokens: 7
  å®Œæˆæ—¶é—´: 2025-07-28T14:27:24.041865139Z

è¯·æ±‚ 5:
  è¯·æ±‚ID: req_4c292676-47f6-4321-b03a-77c4ddbc981d
  èŠ‚ç‚¹: gpu_1 (http://localhost:40006)
  è·¯ç”±ç­–ç•¥: cache_aware
  çŠ¶æ€: completed
  è¾“å…¥tokens: 7
  å®Œæˆæ—¶é—´: 2025-07-28T14:27:23.722377702Z

è¿½è¸ªç»Ÿè®¡ä¿¡æ¯:
Traceback (most recent call last):
  File "/nas/ganluo/sglang/test_request_tracking_fixed.py", line 118, in <module>
    asyncio.run(test_request_tracking())
  File "/usr/local/conda/envs/lg/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/local/conda/envs/lg/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
    return future.result()
  File "/nas/ganluo/sglang/test_request_tracking_fixed.py", line 103, in test_request_tracking
    print(f"  æ€»è¯·æ±‚æ•°: {stats['total_requests']}")
KeyError: 'total_requests'
(lg) root:/nas/ganluo# 